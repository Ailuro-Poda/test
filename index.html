<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode List</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="episodes.json" type="application/json"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Expo Arabic Light';
            src: url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.woff2') format('woff2'),
                 url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.woff') format('woff'),
                 url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.ttf') format('truetype'),
                 url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.otf') format('opentype'),
                 url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.eot') format('embedded-opentype'),
                 url('https://raw.githubusercontent.com/Ailuro-Poda/ExpoArabicLightFont/main/ExpoArabicLight.svg#ExpoArabicLight') format('svg');
        }
        * {
            font-family: 'Expo Arabic Light' !important;
        }

        body {
    background-color: #333333; /* Black background */
    color: #ffffff; /* White text */
}

table {
    background-color: #333333; /* Slightly lighter black for table background */
    color: #ffffff; /* White text for table */
}

input, select {
    background-color: #333333; /* Dark gray input fields */
    color: #ffffff; /* White text for inputs */
    /* border-color: #555555; Subtle border for contrast */
}

button {
    background-color: #444444; /* Dark gray buttons */
    color: #ffffff; /* White text */
}

button:hover {
    background-color: #666666; /* Slightly lighter gray on hover */
}

th, td {
    background-color: #2a2a2a; /* Slightly lighter black for table cells */
    color: #ffffff; /* White text for cells */
}

.tooltip {
    background-color: #333333; /* Dark tooltip background */
    color: #ffffff; /* White text in tooltip */
    border: 1px solid #555555; /* Subtle border for tooltip */
}

    </style>    
</head>
<body class="bg-gray-800 p-4">
    <div id="app" class="max-w-6xl mx-auto p-4 bg-slate-700 shadow-lg rounded">
        <div v-if="error" class="text-red-500 font-bold text-center py-4">{{ error }}</div>        
        <h1 class="text-4xl font-bold mb-4 text-center">المرجع الشامل لمشاهدة المحقق كونان</h1> <br>
        
<!-- Search and Filters -->
<div class="mb-4 flex flex-col gap-4 items-center">
    <div class="flex gap-4 w-full justify-center">
        <select v-model="selectedFilter" class="border px-4 font-bold py-2 rounded">
            <option value="all">الكل</option>
            <option value="anime">الأنمي</option>
            <option value="movies">الأفلام</option>
            <option value="hourly_special">خاصة (ساعة)</option>
            <option value="two_hour_special">خاصة (ساعتين)</option>
        </select>

        <fieldset class="border border-gray-300 rounded p-4 w-1/2">
            <legend class="px-2 font-bold text-black-600">{{ episodeTypeLegend }}</legend>
            <div class="flex items-center font-bold gap-4 justify-center">
                <label>
                    <input type="radio" v-model="episodeTypeFilter" value="All" checked>
                    الكل
                </label>
                <label>
                    <input type="radio" v-model="episodeTypeFilter" value="Manga">
                    مانغا
                </label>
                <label>
                    <input type="radio" v-model="episodeTypeFilter" value="Filler">
                    فلر
                </label>
            </div>
        </fieldset>
    </div>

    <input v-model="searchQuery" class="border px-4 py-2 font-bold text-xl rounded w-full" placeholder="بحث...">
</div>

<!-- Table -->
<div v-if="loading" class="text-center py-4">
    <div class="spinner-border animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"></div>
    جاري التحميل...
</div>
<div v-else>
    <table class="min-w-full border-collapse border border-gray-300">
        <thead>
            <tr class="bg-gray-200">
                <th class="border border-gray-300 text-xl px-2 py-2 text-center w-1/6">
                    {{ episodeNumberHeader }}
                    <div class="relative">
                        <div class="text-lg text-red-600 mt-1" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false">({{ totalEpisodes }})</div>
                        <!-- Tooltip -->
                        <div v-if="showTooltip && selectedFilter === 'all' && episodeTypeFilter ==='All'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات + الأفلام (مانغا + فلر)</div>
                        <div v-if="showTooltip && selectedFilter === 'all' && episodeTypeFilter ==='Manga'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات + الأفلام (مانغا)</div>
                        <div v-if="showTooltip && selectedFilter === 'all' && episodeTypeFilter ==='Filler'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات + الأفلام (فلر)</div>
                        
                        <div v-if="showTooltip && selectedFilter === 'anime' && episodeTypeFilter ==='All'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات (مانغا + فلر)</div>
                        <div v-if="showTooltip && selectedFilter === 'anime' && episodeTypeFilter ==='Manga'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات (مانغا)</div>
                        <div v-if="showTooltip && selectedFilter === 'anime' && episodeTypeFilter ==='Filler'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات (فلر)</div>

                        <div v-if="showTooltip && selectedFilter === 'movies' && episodeTypeFilter ==='All'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الأفلام (مانغا + فلر)</div>
                        <div v-if="showTooltip && selectedFilter === 'movies' && episodeTypeFilter ==='Manga'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الأفلام (مانغا)</div>
                        <div v-if="showTooltip && selectedFilter === 'movies' && episodeTypeFilter ==='Filler'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الأفلام (فلر)</div>

                        <div v-if="showTooltip && selectedFilter === 'hourly_special' && episodeTypeFilter ==='All'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعة" (مانغا + فلر)</div>
                        <div v-if="showTooltip && selectedFilter === 'hourly_special' && episodeTypeFilter ==='Manga'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعة" (مانغا)</div>
                        <div v-if="showTooltip && selectedFilter === 'hourly_special' && episodeTypeFilter ==='Filler'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعة" (فلر)</div>

                        <div v-if="showTooltip && selectedFilter === 'two_hour_special' && episodeTypeFilter ==='All'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعتين" (مانغا + فلر)</div>
                        <div v-if="showTooltip && selectedFilter === 'two_hour_special' && episodeTypeFilter ==='Manga'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعتين (مانغا)</div>
                        <div v-if="showTooltip && selectedFilter === 'two_hour_special' && episodeTypeFilter ==='Filler'" class="absolute bg-gray-800 text-white text-sm px-2 py-1 rounded shadow-lg mt-2">عدد الحلقات الخاصة "ساعتين" (فلر)</div>
                    </div>
                </th>                
                <th class="border border-gray-300 text-xl px-4 py-2 text-center w-5/6">
                    {{ episodeTitleHeader }}
                </th>
            </tr>
        </thead>
                
        <tbody>
            <tr v-for="episode in paginatedEpisodes" :key="episode.EpisodeNumber" class="hover:bg-blue-100">
                <td class="border border-gray-300 px-2 text-lg font-bold py-2 text-center">{{ episode.EpisodeNumber }}</td>
                <td class="border border-gray-300 px-4 text-lg font-bold py-2 text-center">{{ episode.EpisodeTitle }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="flex justify-between items-center mt-4">
        <button @click="goToFirstPage" class="bg-blue-500 text-white font-bold px-4 py-2 rounded hover:bg-blue-600">الأول</button>
        <button @click="nextPage" class="bg-blue-500 text-white font-bold px-4 py-2 rounded hover:bg-blue-600" :disabled="currentPage === totalPages">التالي</button>
        <span class="font-bold">الصفحة {{ currentPage }} من {{ totalPages }}</span>
        <input type="number" min="1" :max="totalPages" v-model="currentPage" @input="handlePageInput($event)" class="w-16 px-2 py-1 rounded border font-bold border-gray-300 text-center" />
        <button @click="prevPage" class="bg-blue-500 text-white font-bold px-4 py-2 rounded hover:bg-blue-600" :disabled="currentPage === 1">السابق</button>
        <button @click="goToLastPage" class="bg-blue-500 text-white font-bold px-4 py-2 rounded hover:bg-blue-600">الأخير</button>
    </div>
</div>
</div>

    <script>
        const { createApp } = Vue;
    
        const jsonUrl = "https://raw.githubusercontent.com/Ailuro-Poda/test/main/episodes.json";
    
        createApp({
            data() {
                return {
                    replacementDict: {
                    "فلم": ["فيلم",],
                    },
                    showTooltip: false, // Controls tooltip visibility
                    episodeTypeFilter: 'All', // Default filter is "All"
                    episodes: [],
                    loading: true,
                    searchQuery: '',
                    selectedFilter: 'all',
                    currentPage: 1,
                    lastPage: 1,
                    pageSize: 15,
                };
            },
            computed: {
            filteredEpisodes() {
                const searchQuery = this.normalizeText(this.searchQuery);

                    // Filter by EpisodeType
                    let filteredByType = this.episodes;
                    if (this.episodeTypeFilter === 'Manga') {
                        filteredByType = filteredByType.filter(
                            episode => episode.EpisodeType === 'م' || episode.EpisodeType === 'ث'
                        );
                    } else if (this.episodeTypeFilter === 'Filler') {
                        filteredByType = filteredByType.filter(
                            episode => episode.EpisodeType === 'ف' || episode.EpisodeType === 'ث'
                        );
                    }

                    // Apply other filters (e.g., category and search query)
                    return filteredByType
                        .filter(episode => {
                            if (this.selectedFilter === 'anime') {
                                return /^[0-9]+(\.[0-9]+)?$/.test(episode.EpisodeNumber);
                            } else if (this.selectedFilter === 'movies') {
                                return episode.EpisodeNumber.includes("الفيلم");
                            } else if (this.selectedFilter === 'hourly_special') {
                                return episode.EpisodeSpecial === "1"; // Filter for خاصة (ساعة)
                            } else if (this.selectedFilter === 'two_hour_special') {
                                return episode.EpisodeSpecial === "2"; // Filter for خاصة (ساعتين)
                            }
                            return true;
                        })
                        .filter(episode =>
                            new RegExp(searchQuery, 'i').test(episode.EpisodeTitle) ||
                            new RegExp(searchQuery, 'i').test(episode.EpisodeNumber)
                        );
            },
                totalPages() {
                    return Math.ceil(this.filteredEpisodes.length / this.pageSize);
                },
                paginatedEpisodes() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    return this.filteredEpisodes.slice(start, start + this.pageSize);
                },
                totalEpisodes() {
                    return this.filteredEpisodes.length; // Calculates based on the filtered episodes
                },
                episodeNumberHeader() {
                    return this.selectedFilter === 'movies' ? 'رقم الفلم' : 'رقم الحلقة';
                },
                episodeTitleHeader() {
                    return this.selectedFilter === 'movies' ? 'عنوان الفلم' : 'عنوان الحلقة';
                },
                episodeTypeLegend() {
                    return this.selectedFilter === 'movies' ? 'نوع الفلم' : 'نوع الحلقة';
                }
            },
            watch: {
                searchQuery(newQuery) {
                    if (newQuery.trim() === '') {
                        this.currentPage = Math.min(this.lastPage, this.totalPages) || 1;
                    } else {
                        this.currentPage = 1;
                    }
                }
            },
            methods: {
                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                        this.trackLastPage();
                    }
                },
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.trackLastPage();
                    }
                },
                goToPage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                        this.trackLastPage();
                    }
                },
                trackLastPage() {
                    this.lastPage = this.currentPage;
                },
                goToFirstPage() {
                    this.currentPage = 1;
                    this.trackLastPage();
                },
                goToLastPage() {
                    this.currentPage = this.totalPages;
                    this.trackLastPage();
                },
                handlePageInput(event) {
                const pageInput = event.target.value;
                let pageNumber = parseInt(pageInput, 10);
                
                // Ensure the page number is within the valid range
                if (isNaN(pageNumber) || pageNumber < 1) {
                    pageNumber = 1;
                } else if (pageNumber > this.totalPages) {
                    pageNumber = this.totalPages;
                }

                this.currentPage = pageNumber;
                event.target.value = pageNumber; // Reset the value of the input to the corrected page number
                this.trackLastPage();
            },

                normalizeText(text) {
                let normalizedText = text.toLowerCase();
                for (let [key, values] of Object.entries(this.replacementDict)) {
                    const regex = new RegExp(key, 'g'); // Global search for the word
                    normalizedText = normalizedText.replace(regex, (match) => {
                        // Replace with all possible values, separated by "|"
                        return `(${values.join("|")})`;
                    });
                }
                return normalizedText;
            }
            },
            mounted() {
            fetch(jsonUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    this.episodes = data;
                    this.loading = false;
                })
                .catch(error => {
                    this.error = 'Failed to load. Please try again later.';
                    this.loading = false;
                });
        }
        }).mount('#app');
    </script>             
</body>
</html>